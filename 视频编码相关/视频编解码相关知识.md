# 视频编码

从采集视频开始，经过编码（H.264/H.265），封装成MP4或PS流，然后通过RTMP或RTP传输，客户端通过RTSP控制播放等。

> 视频编码: 又称视频压缩，就是将原始视频数据压缩，减少体积，方便存储和传输。

## 一些基本术语

### 分辨率

> 定义：视频画面的像素数量，例如 1920x1080（1080p）、3840x2160（4K）

分辨率决定画面的清晰度和细节。

分辨率高 ≠ 一定清晰！如果码率不足，高分辨率反而会模糊（就像大画布上颜料不够，只能涂鸦）。

常见标准：720p（高清）、1080p（全高清）、4K（超高清）。


### 帧率

### 码率

## 常见的视频编码格式

|常见视频压缩格式|说明|
|-|-|
|H.264（AVC）|最常见的编码标准，压缩效率高，兼容性好，广泛用于视频网站、监控等。|
|H.265（HEVC）|H.264 的升级版，压缩效率提升约50%，但计算复杂度更高，适合 4K/8K 等高分辨率视频。|


## 编码时生成的关键帧

|关键帧类型|说明|
|-|-|
|I帧（关键帧）|完整画面，不依赖其他帧，解码起点。|
|P帧（预测帧）|基于前一帧（I或P帧）的差异压缩，体积更小。|
|B帧（双向预测帧）|基于前后帧的差异压缩，压缩率更高，但延迟增加（如视频会议不用B帧）。|


## 视频封装格式

> 视频封装: 将编码后的视频、音频、字幕等打包成一个文件，或用于传输流。

|常见封装格式|说明|
|-|-|
|MP4|最常见的封装格式，支持H.264/H.265编码，适合本地存储和在线点播（如视频网站）。|
|PS流（Program Stream）|用于DVD等存储场景，封装较简单，对传输错误不敏感。|
|TS流（Transport Stream）|用于广播电视和流媒体（如直播），支持分片传输，抗干扰性强。|

## 流媒体传输协议

> 流媒体传输协议：在网络上实时传输音视频数据，支持直播、点播等场景。

|传输协议|功能|应用|
|-|-|-|
|RTSP（Real-Time Streaming Protocol）|控制媒体流的播放、暂停等（类似“遥控器”），不直接传输数据。|监控摄像头（如通过VLC播放RTSP流）|
|RTP（Real-Time Transport Protocol）|实际传输音视频数据，常与RTSP配合使用（RTSP控制，RTP传输）。|支持时间戳和序列号，解决网络抖动和乱序问题。|
|RTMP（Real-Time Messaging Protocol）|基于TCP的协议，低延迟（1-3秒），但受限于TCP可能在高丢包率下卡顿。|最初用于Flash直播，现仍用于推流（如主播推流到服务器）。|
|HLS（HTTP Live Streaming）|苹果推出的基于HTTP的流媒体协议，将视频切分为TS小文件，适合自适应码率（如B站、YouTube）。||


## 典型流程

下面介绍几个典型场景

- 直播场景：
主播端 → 摄像头采集 → H.264编码 → 封装为FLV → RTMP推流到服务器 → 服务器转HLS/RTMP → 观众通过HTTP/HLS或RTMP播放。

- 监控场景：
摄像头 → H.265编码 → 封装为PS流 → RTSP控制 + RTP传输 → 客户端接收并解码播放。

- 点播网站：
视频文件 → H.264编码 → 封装为MP4 → 通过HTTP渐进下载或HLS分片传输 → 浏览器播放。